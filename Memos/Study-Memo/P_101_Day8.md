# 20210416

## SQL数据库访问

### 远程数据库以进行股票池策略的维护更新

SQL语言强大的集合（交并差）操作，嵌套查询，聚合操作能力。

连eduroam不能访问，连接DIVI可以访问。

exists：内外表不同名称，Product p1、Product p2。

### SQLite操作本地数据

预编译。integer整型，real实数类型，blob二进制存储、原样存储。

with sqlite3.connect('university.db') as db: *数据库文件是university.db，不存在，则自动创建；重复执行会导致数据库锁死。*

cursor = db.cursor() *创建光标*

db.commit() *提交到数据库*

cursor.fetchall() *按照select的顺序读取。要排序就order by。可以直接print可以逐一print。*

cursor.execute('insert into enrolled (student_id,class_id, credit,score) \
            values (?,?,?,?)', (student_id, class_id, credit, score))

cursor.execute('insert into enrolled (student_id,class_id, credit,score) \
            values ({},{},{},{})'.format(student_id, class_id, credit, score))

cursor.close()

db.close() *一直连接访问会阻止其他访问数据库。*

SQLite只有left join。实现right join：两个表顺序反一下。full join：union两次join。

## 量化交易部分 经典资金管理模型以及股票池筛选的避险讨论

资金管理与量化特征。难在执行。

### 量化交易的核心问题-资金管理模型

交易策略成败三个核心变量：
方向（算卦算方向），
时机（信号系统，出入场），
头寸（老师认为最重要）。

确定头寸规模
每一固定金额交易一个单位。资金利用不对称，使用少。
等价值交易单位。每一份尽量用满。股价差异大，资金不大时分配上量化误差。
百分比风险模型。对风险进行度量，对比前两个不涉及风险，只是资金分配。
百分比波动幅度模型。考虑每只股的风险不统一。ATR（海龟交易法中的N值）度量波动性。多用于CDA商品期货策略。

进一步讨论
波动风险：多个品种风险之间的关系
流动性风险：持仓头寸不超过该股票流通市值的2%（一旦高，成为大股东，卖不掉，摁到跌停），日成交量不超过该股票成交量的10%（也可能严重影响价格）。
保证金交易高杠杆，流动性问题更复杂，可能出现毛刺。

细节考虑-资金
单日可用资金上限
单个交易标的资金上限
总可用资金上限

名词解释
总风险：针对账户。根据个人的容忍度确定
单个头寸风险：针对某一笔交易
初始风险：投资组合建立之初的总风险
持续风险：投资组合存续过程中的总风险
风险暴露：一般指某一时刻的持续风险

CPR公式：P（头寸规模）=C（总风险）/R（每股风险，单个头寸风险）。
可能头寸过于激进，容易超仓。设置最大持仓上限，平均分配风险以分散化。

头寸规模的定期调整：初始风险和持续风险。不建议调高止损线。

### 股票池筛选的避险讨论-财务报表的量化特征

本福特定律：以1为首位的数字出现的频率约为30%。
数据不能是按照规律排列的，不能经过人工干预（鉴别财务报表数据是否经过人工改造）。

故事：杀死比尔Bill。
风险集中爆发。给保证金加杠杆。为避免竞争对手发现，和投行收益互换。资金杠杆率不大，但美股对中概股利空导致波动风险大。尾部风险。投行为了避免进一步损失主动平仓。
不要单一重仓，重视流动性风险，不要太贪心。